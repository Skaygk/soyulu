<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>SIGMIZA</title>

<style>
  
body {
  font-family: Arial;
  background: #000;
  color: #9400D3;
  text-align: center;
  margin: 0;
  padding: 15px;
}

.logo-container {
  margin: 15px 0;
}

.logo {
  width: 60%;
  max-width: 280px;
  height: auto;
  animation: latido 1.8s infinite ease-in-out;
}

@keyframes latido {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.12); }
}

a {
  display: inline-block;
  margin: 10px 0 20px;
  color: #b84cff;
  text-decoration: none;
  font-weight: bold;
}

.table-wrapper {
  overflow-x: auto;
}

table {
  width: 100%;
  min-width: 700px;
  max-width: 1000px;
  margin: 0 auto;
  border-collapse: collapse;
  color: #fff;
}

th, td {
  border: 2px solid #9400D3;
  padding: 10px;
}

th {
  background: #120012;
  color: #b84cff;
}

button {
  padding: 8px 14px;
  background: #b84cff;
  border: none;
  font-weight: bold;
  cursor: pointer;
}

button.borrar {
  background: #ff00aa;
  color: #000;
}

button.borrar:hover {
  background: #ff33cc;
}

#modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
}

#modal-box {
  background: #000;
  color: #b84cff;
  border: 2px solid #9400D3;
  width: 90%;
  max-width: 600px;
  margin: 10% auto;
  padding: 20px;
  text-align: left;
}

#cerrar {
  float: right;
  cursor: pointer;
  font-weight: bold;
}

@media (max-width: 768px) {
  body { padding: 10px; }
  .logo { width: 75%; max-width: 220px; }
  table { font-size: 14px; }
  th:nth-child(4), td:nth-child(4) { display: none; }
  button { padding: 10px; font-size: 14px; }
}
</style>
</head>

<body>

<div class="logo-container">
  <img src="recursos/sigma.jpg" alt="SIGMIZA" class="logo">
</div>

<a href="upload.html">Subir carpeta</a>

<div class="table-wrapper">
<table>
<thead>
<tr>
  <th>Titulo</th>
  <th>Autor</th>
  <th>Usuario</th>
  <th>Contenido</th>
  <th>Fecha</th>
  <th>Ver</th>
  <th>Borrar</th>
</tr>
</thead>
<tbody id="lista"></tbody>
</table>
</div>

<div id="modal">
  <div id="modal-box">
    <span id="cerrar">X</span>
    <h2 id="m-titulo"></h2>
    <p id="m-autor"></p>
    <pre id="m-contenido"></pre>
    <p id="m-fecha"></p>
  </div>
</div>

<script>
const modal = document.getElementById('modal');
const cerrar = document.getElementById('cerrar');
const mTitulo = document.getElementById('m-titulo');
const mAutor = document.getElementById('m-autor');
const mContenido = document.getElementById('m-contenido');
const mFecha = document.getElementById('m-fecha');

async function registrarVisita() {
  try {
    await fetch('/api/track', { method: 'POST' });
  } catch {}
}

async function cargarCarpetas() {
  const res = await fetch('/api/obtenerCarpetas');
  const data = await res.json();
  const tbody = document.getElementById('lista');
  tbody.innerHTML = '';

  data.forEach(f => {
    const tr = document.createElement('tr');

    const c = (txt) => {
      const td = document.createElement('td');
      td.textContent = txt;
      return td;
    };

    tr.append(
      c(f.titulo),
      c(f.autor),
      c(f.subido_por),
      c(f.contenido.length > 50 ? f.contenido.slice(0,50)+'...' : f.contenido),
      c(f.created_at ? new Date(f.created_at).toLocaleString() : 'Sin fecha')
    );

    const tdVer = document.createElement('td');
    const btnVer = document.createElement('button');
    btnVer.textContent = 'Ver';
    btnVer.onclick = () => abrirModal(f);
    tdVer.appendChild(btnVer);

    const tdBorrar = document.createElement('td');
    const btnBorrar = document.createElement('button');
    btnBorrar.textContent = 'Borrar';
    btnBorrar.className = 'borrar';
    btnBorrar.onclick = () => borrarCarpeta(f.id);
    tdBorrar.appendChild(btnBorrar);

    tr.append(tdVer, tdBorrar);
    tbody.appendChild(tr);
  });
}

function abrirModal(f) {
  mTitulo.textContent = f.titulo;
  mAutor.textContent = 'Autor: ' + f.autor;
  mContenido.textContent = f.contenido;
  mFecha.textContent = f.created_at ? new Date(f.created_at).toLocaleString() : '';
  modal.style.display = 'block';
}

cerrar.onclick = () => modal.style.display = 'none';

async function borrarCarpeta(id) {
  const password = prompt('ContraseÃ±a admin:');
  if (!password) return;

  const res = await fetch('/api/borrarCarpeta', {
    
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ id, password })
  });

  const r = await res.json();
  if (r.ok) cargarCarpetas();
  else alert(r.error);
}

window.onload = () => {
  registrarVisita();
  cargarCarpetas();
};
</script>

<script>
  window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };
</script>
<script defer src="/_vercel/speed-insights/script.js"></script>

</body>
</html>
